add-highlighter global/ number-lines

hook global InsertChar \' %{ exec \'<left> }
hook global InsertChar \" %{ exec \"<left> }
hook global InsertChar ` %{ exec `<left> }
hook global InsertChar \( %{ exec )<left> }
hook global InsertChar \[ %{ exec ]<left> }
hook global InsertChar \{ %[ exec }<left> ]
define-command -hidden exit-pair-or-advanced-complete %{
  execute-keys 'h'
  try %{ execute-keys 's\n<ret>l<a-C><a-&>(<space>' }
  try %{ execute-keys 's(\w|\d)<ret>l<esc>b~/\W<ret>' }
  try %{ execute-keys 's<space><ret>l<esc>b;~/\W<ret>l' }
  try %{ execute-keys 's:<ret>d<esc>\A:<space><esc>' }
  try %{ execute-keys 's<semicolon><ret>d<esc>\A<semicolon><esc>' }
  try %{ execute-keys 's,<ret>d<esc>\A<space>{}<esc>h' }
  try %{ execute-keys 's/<ret>d<a-b>"x\c<lt><c-r>x<gt><lt>/<c-r>x<gt><esc><a-f><lt>;' }
  try %{ execute-keys 's\\<ret>d<esc>\i<tab><esc>' }
  try %{ execute-keys 's\.<ret>dl' }
}

define-command -hidden align-selection %{ try %{ execute-keys '<a-C><a-&>(<space>' } }
define-command -hidden extend-next-hump %{ execute-keys ?[A-Z][a-z]+|[A-Z]+|[a-z]+<ret> }
define-command -hidden extend-previous-hump %{ execute-keys <a-?>[A-Z][a-z]+|[A-Z]+|[a-z]+<ret> }

def switch-number-line -params .. %{
  try %{ remove-highlighter window/number_lines }
  add-highlighter window/number_lines number-lines %arg{@}
}
hook global NormalKey 0 'switch-number-line -relative'
hook global NormalKey \D.* 'switch-number-line'

hook global InsertDelete ' ' %{ try %{ execute-keys -draft 'h<a-h><a-k>\A\h+\z<ret>i<space><esc><lt>' }}
hook global InsertCompletionShow .* %{
  try %{
    execute-keys -draft 'h<a-K>\h<ret>'
    map window insert '<s-tab>' '<c-p>' -docstring 'previous autocomplete suggestion'
    map window insert '<a-space>' '<c-o>' -docstring 'stop autocomplete for this insert session'
    map window insert '<tab>' '<c-n>' -docstring 'next autocomplete suggestion'
    hook -once -always window InsertCompletionHide .* %{
      map window insert '<s-tab>' '<ret><esc>O' -docstring 'insert indented block'
      map window insert '<a-space>' ' ' -docstring 'insert space'
      map window insert '<tab>' '<esc>: exit-pair-or-advanced-complete<ret>i' -docstring 'exit pair or advanced complete'
    }
  }
}

map global goto '0' 'h' -docstring 'to line start'
map global goto 'J' '<esc><a-J>' -docstring 'join lines'
map global goto 'T' '<esc>s[^\d\s\W]+<ret>`<a-;>;~<space>' -docstring 'change selection to title case'
map global goto 'u' '<esc>`' -docstring 'change selection to lower case'
map global goto 'U' '<esc>~' -docstring 'change selection to upper case'
map global goto 'V' '<esc>V' -docstring 'lock view mode'

map global insert '<a-space>' ' ' -docstring 'insert space'
map global insert '<s-ret>' '<ret><esc>O' -docstring 'insert indented block'
map global insert '<s-tab>' '<esc>P' -docstring 'paste default register'
map global insert '<tab>' '<esc>: exit-pair-or-advanced-complete<ret>i' -docstring 'exit pair or advanced complete'

map global normal '<a-space>' '<space>' -docstring 'remove additional selections'
map global normal '<backspace>' '<a-space>' -docstring 'remove main selection'
map global normal '<c-r>' 'U' -docstring 'redo'
map global normal '<ret>' '<a-O>' -docstring 'add line above'
map global normal '<s-ret>' '<a-x><a-s>' -docstring 'split selection into lines'
map global normal '<s-tab>' '<a-)>' -docstring 'rotate contents right'
map global normal '<space>' ';' -docstring 'collapse selection'
map global normal '<tab>' '<)>' -docstring 'rotate selection right'
map global normal '`' 'z' -docstring 'restore selection from register'
map global normal '!' '!date' -docstring 'insert external command'
map global normal '~' '<a-`>' -docstring 'swap case'
map global normal '@' 'q' -docstring 'play macro'
map global normal '#' '<a-s>i<c-r>#<esc>;' -docstring 'enumerate selections'
map global normal '$' '<a-L>' -docstring 'select to line end'
map global normal '%' 'm' -docstring 'select to matching pair'
map global normal '^' 'Gi' -docstring 'select to line start'
map global normal '*' '<a-i>w*' -docstring 'find word under cursor'
map global normal '(' ': extend-previous-hump<ret>' -docstring 'extend previous word part'
map global normal ')' ': extend-next-hump<ret>' -docstring 'extend next word part'
map global normal '<minus>' ': comment-line<ret>' -docstring 'comment/uncomment line'
map global normal '_' '<a-x>: comment-block<ret>' -docstring 'comment/uncomment block'
map global normal '=' ': align-selection<ret>' -docstring 'align selection'
map global normal '{' '{p' -docstring 'extend to paragraph start'
map global normal '}' '}p' -docstring 'extend to paragraph end'
map global normal ';' 'L<a-.>' -docstring 'repeat last find'
# map global normal "'" '' -docstring ''
map global normal '|' '<a-x>|sort' -docstring 'pipe and replace with output'
map global normal 'a' 'li' -docstring 'append after cursor'
map global normal 'B' '<a-B>' -docstring 'select to WORD start'
map global normal 'C' 'Glc' -docstring 'change to line end'
map global normal 'D' 'Gld' -docstring 'delete to line end'
map global normal 'E' '<a-E>' -docstring 'select to WORD end'
map global normal 'f' 'F' -docstring 'select to find character forwards'
map global normal 'F' '<a-F>' -docstring 'select to find character backwards'
map global normal 'g' 'G' -docstring 'select to begin of object'
map global normal 'G' 'Ge' -docstring 'select to end of buffer'
map global normal 'm' 'Z' -docstring 'save selection to register'
map global normal 'M' '<a-Z>' -docstring 'append selection to register'
map global normal 'n' 'n' -docstring 'select to find next match'
map global normal 'N' '<a-n>' -docstring 'select to previous next match'
map global normal 'q' 'Q' -docstring 'start macro recording'
map global normal 'Q' '<a-C>' -docstring 'add selection above'
map global normal 'R' 'R<a-;>;' -docstring 'replace selection with register'
map global normal 't' 'T' -docstring 'select to find character forwards'
map global normal 'T' '<a-T>' -docstring 'select to find character backwards'
map global normal "U" '<a-;>' -docstring 'swap cursor and anchor'
map global normal 'V' '<a-x>' -docstring 'extend selection to full lines'
map global normal 'W' '<a-W>' -docstring 'select to next WORD start'
map global normal 'x' '<a-K>' -docstring 'exclude (keep not matching)'
map global normal 'X' '<a-k>' -docstring 'keep matching'
map global normal 'y' 'y<a-;>;' -docstring 'yank'
map global normal 'Y' 'Gly<a-;>;' -docstring 'yank to line end'
map global normal 'z' 'v' -docstring 'view mode'
map global normal 'Z' 'C' -docstring 'add selection below'

map global object 'a' '<esc>%' -docstring 'entire buffer'
map global object 'W' '<a-w>' -docstring 'WORD'

map global user '<tab>' '<esc><(>' -docstring 'rotate selection left'
map global user '<s-tab>' '<esc><a-(>' -docstring 'rotate contents left'
map global user '$' '<esc><a-x>$grep' -docstring 'pipe and keep those who succeed'
map global user '<minus>' '<esc><a-x>ypj<a-x>_r-<a-h>' -docstring 'underline string with -'
map global user '_' '<esc>_' -docstring 'trim selections'
map global user '=' '<esc><a-x>ypj<a-x>_r=<a-h>' -docstring 'underline string with ='
map global user ',' '<esc>;<space>' -docstring 'clear all'

map global view 'a' '<esc><a-a>' -docstring '<a-a>'
map global view 'i' '<esc><a-i>' -docstring '<a-i>'

set global indentwidth 2
set global tabstop 2

colorscheme tomorrow-night
